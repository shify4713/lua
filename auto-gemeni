event.listen("key_down", function(_, _, key, _, _)
    if changeitem then
        if key == 28 then -- Enter
            if inputActive then
                if inputBuffer == "" then
                    -- Пропустить поле, если оно пустое
                    currentField = currentField + 1
                    if currentField > 4 then
                        saveItem() -- Сохранить элемент, если все поля пройдены
                        changeitem = false
                        inputActive = false
                        draw()
                    else
                        -- Перейти к следующему полю
                        inputBuffer = inputFields[{"name", "category", "count", "craftSize"}[currentField]] or ""
                        draw()
                    end
                else
                    -- Подтвердить ввод в текущем поле
                    inputFields[{"name", "category", "count", "craftSize"}[currentField]] = inputBuffer
                    currentField = currentField + 1
                    if currentField > 4 then
                        saveItem()
                        changeitem = false
                        inputActive = false
                    else
                        inputBuffer = inputFields[{"name", "category", "count", "craftSize"}[currentField]] or ""
                    end
                    draw()
                end
            else
                -- Активировать ввод, начиная с первого поля
                inputActive = true
                currentField = 1
                inputBuffer = inputFields[{"name", "category", "count", "craftSize"}[currentField]] or ""
                draw()
            end
        elseif inputActive then
            -- Обработка символов для ввода
            if key >= 32 and key <= 126 then
                inputBuffer = inputBuffer .. string.char(key)
                draw()
            elseif key == 14 then -- Backspace
                inputBuffer = inputBuffer:sub(1, -2)
                draw()
            end
        end
        return
    end
    -- Остальная логика программы
end)

function draw()
    -- Отрисовка экрана только при необходимости
    term.clear()
    -- Здесь код отрисовки интерфейса
end

function saveItem()
    -- Логика сохранения элемента
end
